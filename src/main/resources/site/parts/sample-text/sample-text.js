var libs = {
    portal: require('/lib/xp/portal'),
    thymeleaf: require('/lib/thymeleaf'),
    util: require('/lib/util')
};

// Handle GET request
exports.get = handleGet;

function handleGet(req) {
    var component = libs.portal.getComponent();
    var view = resolve('sample-text.html');
    var model = createModel();

    function createModel() {
        var model = {};
        var numOfWords = component.config.numOfWords;
        model.text = getText(numOfWords);
        return model;
    }

    function getText(numOfWords) {
        var text = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam varius, lacus sit amet consectetur fringilla, lectus enim cursus turpis, vitae mattis lectus arcu porttitor orci. Morbi commodo egestas magna, vel elementum leo vulputate vitae. Mauris et lacinia enim. Vivamus tristique accumsan efficitur. Aliquam erat lacus, porta cursus porta id, volutpat nec dui. Donec ac diam quam. Nam ex velit, tincidunt aliquet tristique at, interdum vel quam. Aliquam efficitur, lacus in ultrices vehicula, dui magna pharetra lectus, id mollis ipsum nunc ac nibh. Phasellus nec aliquet mauris. Proin felis sem, sodales et convallis sit amet, dapibus at felis. Suspendisse lacinia magna vitae sapien porta, sed aliquam nibh vulputate. Ut pharetra massa a libero hendrerit, at mollis nulla malesuada. Donec sit amet nisi neque. Vivamus venenatis magna ut metus dapibus, eu scelerisque velit scelerisque. Nullam aliquam efficitur sodales. Proin in nunc viverra, lacinia odio sit amet, porttitor turpis. Curabitur posuere odio mattis libero malesuada convallis. Etiam sed nulla ut massa condimentum placerat. Vestibulum blandit ac magna in vestibulum. Nunc viverra pharetra leo et cursus. Pellentesque pharetra tempus mi a consectetur. Cras ultrices nunc risus, eu facilisis justo lobortis ut. Morbi ullamcorper ligula at tellus scelerisque, nec rutrum metus venenatis. Integer libero mauris, placerat ut nunc id, viverra luctus tellus. Praesent rhoncus elit et quam congue bibendum. Maecenas vitae purus risus. Suspendisse vel pretium enim. Suspendisse potenti. Donec eget ligula in purus lacinia elementum ac vel metus. Pellentesque dictum odio non turpis ultrices, non luctus lacus scelerisque. Pellentesque ac tristique leo, ac porttitor diam. Etiam pretium ipsum in ex venenatis, ac tristique diam interdum. Donec eget dictum erat, vitae hendrerit neque. Sed vitae magna et dui vulputate elementum. Aliquam et eros porttitor, eleifend ligula ac, pretium eros. Sed malesuada ante sed mauris ornare malesuada. Donec vulputate lobortis odio non dapibus. Vestibulum cursus sit amet erat quis pellentesque. Aliquam ut enim mattis, placerat elit non, varius neque. Donec ac justo eu sapien maximus ornare quis quis nunc. Sed ultricies elit ac lectus vulputate, vitae condimentum mi efficitur. Curabitur nec accumsan mauris. Nulla facilisi. Maecenas non tortor porta, laoreet tellus sed, rutrum dolor. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Fusce nec urna dignissim, scelerisque sem ut, porttitor sapien. Vestibulum metus nunc, scelerisque sit amet tincidunt eget, gravida ultricies risus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent sed iaculis sem, nec condimentum nisl. Vestibulum a sodales magna. Quisque nisi lorem, rhoncus ac accumsan quis, commodo sed magna. Phasellus auctor diam nisl, et euismod ligula elementum scelerisque. Sed libero tellus, sodales in est sit amet, lobortis auctor dolor. Quisque vitae fringilla purus, quis mattis dolor. Praesent mollis, libero at ullamcorper posuere, augue ipsum cursus sapien, ac maximus lectus nibh auctor ligula. Suspendisse dignissim elit vestibulum, vehicula erat quis, scelerisque ipsum. Sed malesuada sollicitudin nibh, condimentum tincidunt sapien lacinia ut. Nam tempus neque eget dui maximus, sed tempus dui elementum. Donec sit amet suscipit ex. Nulla facilisi. Aliquam sed dui ipsum. Aliquam sollicitudin leo nibh, at mollis nulla auctor porta. Mauris nisl mi, gravida non dictum eu, faucibus id augue. Suspendisse egestas, magna a hendrerit luctus, diam quam imperdiet dolor, id maximus dolor velit nec est. Nullam hendrerit massa non aliquet iaculis. Fusce semper, eros nec finibus posuere, justo nisl sollicitudin risus, at lacinia enim eros at felis. Donec volutpat eros vel nunc volutpat placerat at at metus. Fusce vel tristique purus. Fusce consectetur augue nec fringilla auctor. Aliquam consectetur eleifend elit, vitae hendrerit tellus hendrerit sit amet. Maecenas euismod urna sit amet sapien consectetur commodo in sed metus. Nam id volutpat turpis. Curabitur convallis metus sed sem sagittis, ac pellentesque risus laoreet. Donec suscipit consequat mi non ullamcorper. Integer ex risus, rhoncus eu posuere nec, lobortis malesuada leo. Cras eget faucibus leo. Praesent non semper risus, ac molestie nibh. Maecenas convallis orci lacus, ac egestas neque bibendum vel. Morbi elementum sollicitudin lacus, at posuere justo finibus id. Sed ac mi et tellus luctus egestas. Maecenas suscipit egestas libero, dictum venenatis enim vehicula vel. Etiam interdum libero vitae magna tempor posuere. Fusce tempus pharetra ipsum auctor venenatis. Donec dictum nibh a ultricies vehicula. Donec nibh nisl, maximus vitae congue a, finibus a velit. Nulla placerat eleifend placerat. Integer laoreet nunc nec consequat tristique. Sed urna lorem, tincidunt sit amet ex eu, finibus placerat turpis. Vestibulum id blandit metus. Curabitur nec rutrum ipsum. Vivamus aliquet nibh eget diam aliquet, ut tincidunt urna malesuada. Phasellus cursus sem nisi, at varius erat interdum ultrices. Pellentesque tincidunt suscipit est, in tincidunt mauris venenatis nec. Fusce porta odio quis tellus rutrum, eget mattis tellus fringilla. Quisque aliquet ut nisi ut pretium. Ut et ex non neque feugiat hendrerit id nec elit. Praesent aliquam ipsum in ipsum imperdiet posuere. Curabitur diam risus, molestie sed diam vitae, dapibus mattis lorem. Sed rhoncus, nulla ac sollicitudin dictum, urna massa porttitor ex, quis aliquet dui lectus consectetur tellus. Maecenas ut risus volutpat enim porttitor rhoncus. Curabitur imperdiet justo in hendrerit porta. Integer vitae purus fringilla, ultrices nisl eget, dictum arcu. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nunc sed felis lectus. In suscipit massa nulla, vehicula vestibulum odio sollicitudin eget. Sed nisl ex, posuere id risus sed, consectetur vulputate dui. Vivamus gravida ac nunc sit amet pulvinar. Vivamus aliquam erat ac nunc ultrices, in varius lorem fermentum. Integer nec magna fringilla, dictum ipsum nec, interdum ex. Ut cursus tortor id dui ultrices, a laoreet lacus feugiat. Duis semper, risus vitae vehicula ultrices, neque massa aliquam nisl, eget tincidunt augue nibh ut metus. Sed tincidunt imperdiet volutpat. Morbi fermentum, nisi eget dictum vestibulum, nunc libero hendrerit ex, vel tincidunt nunc libero ut augue. Integer luctus vitae lacus non varius. Vestibulum sit amet odio elit. Mauris laoreet nunc nec suscipit porttitor. Nulla laoreet orci ut augue blandit, sit amet fringilla mauris varius. Mauris lobortis, velit nec pellentesque vehicula, dolor eros dictum erat, at sagittis neque felis at neque. Sed ut ligula mattis.';
        var truncatedText = text.split(' ').splice(0, numOfWords).join(' ');
        return truncatedText;
    }

    return {
        body: libs.thymeleaf.render(view, model)
    };
}